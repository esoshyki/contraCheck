<div class="container">
  <div class="test" style="width: 160px; height: 145px"></div>
  <div class="control">
    <button id="animateButton">
      Animate
    </button>
    <button id="stopButton">
      Stop
    </button>
    <select id="selectFrame">

    </select>

  </div>
</div>

<script>
  const jump = {
    slides: [
      //Стойка
      // { x: 0, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -78, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -156, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -234, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -312, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -390, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -468, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -546, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -624, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -702, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -780, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -858, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -936, y: 0, w: 78, h: 112, duration: 70 },
      // { x: -1014, y: 0, w: 78, h: 112, duration: 70 },

      //Полет
      // { x: 0, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -183, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -366, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -549, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -732, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -915, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -1098, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -1281, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -1464, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -1647, y: -112, w: 183, h: 140, duration: 70 },
      // { x: -1830, y: -112, w: 183, h: 140, duration: 70 },

      //Атака вверх
      // { x: 0, y: -328, w: 212, h: 137, duration: 70 },
      // { x: -212, y: -328, w: 212, h: 137, duration: 70 },
      // { x: -424, y: -328, w: 212, h: 137, duration: 70 },
      // { x: -636, y: -328, w: 212, h: 137, duration: 70 },
      // { x: -848, y: -328, w: 212, h: 137, duration: 70 },
      // { x: -1060, y: -328, w: 212, h: 137, duration: 70 },
      // { x: -1272, y: -328, w: 212, h: 137, duration: 70 },

      // //Атака вниз
      { x: 0, y: -470, w: 212, h: 115, duration: 70 },
      { x: -212, y: -470, w: 212, h: 115, duration: 70 },
      { x: -424, y: -470, w: 212, h: 115, duration: 70 },
      { x: -636, y: -470, w: 212, h: 115, duration: 70 },
      { x: -848, y: -470, w: 302, h: 115, duration: 70 },
      //{ x: -1060, y: -470, w: 212, h: 137, duration: 70 },
      { x: -1272, y: -470, w: 302, h: 115, duration: 70 },
      { x: -848, y: -470, w: 302, h: 115, duration: 70 },
      { x: -1272, y: -470, w: 302, h: 115, duration: 70 },
      { x: -848, y: -470, w: 302, h: 115, duration: 70 },
      { x: -1272, y: -470, w: 302, h: 115, duration: 70 },
      { x: -848, y: -470, w: 302, h: 115, duration: 70 },
      { x: -1272, y: -470, w: 302, h: 115, duration: 70 },
      { x: -848, y: -470, w: 302, h: 115, duration: 70 },
      { x: -1272, y: -470, w: 302, h: 115, duration: 70 },
      { x: -848, y: -470, w: 302, h: 115, duration: 70 },
      { x: -636, y: -470, w: 212, h: 115, duration: 70 },
      { x: -424, y: -470, w: 212, h: 115, duration: 70 },
      { x: -212, y: -470, w: 212, h: 115, duration: 70 },
      { x: 0, y: -470, w: 212, h: 115, duration: 70 },
    ],
    isCycle: true
  };

  const fall = {
    slides: [
      //{ x: -264, y: -100, w: 41, h: 78, duration: 120 },
      // { x: -303, y: -100, w: 41, h: 78, duration: 120 },
    ],
    isCycle: true
  };

  const jumpAndFire = {
    slides: [
      // { x: 0, y: -236, w: 160, h: 142, duration: 70 },
      // { x: -150, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -300, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -450, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -600, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -750, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -900, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -1050, y: -236, w: 150, h: 142, duration: 70 },
      // { x: -1200, y: -236, w: 150, h: 142, duration: 70 },
    ],
    isCycle: true
  };

  let frameId = 0;
  let timeOut;

  const element = document.querySelector('.test');

  const drawFrame = frame => {
    const { x, y, w, h, duration } = frame;
    element.style.backgroundPositionX = `${x}px`;
    element.style.backgroundPositionY = `${y}px`;
    element.style.width = `${w}px`;
    element.style.height = `${h}px`;
    return duration;
  }

  const animate = (..._animations) => {
    const animations = [..._animations];
    let idx;
    clearTimeout(timeOut);

    const nextSlide = (slides, isCycle) => {

      const duration = drawFrame(slides[frameId]);

      if (isCycle) {
        frameId = (frameId + 1) % slides.length;
        timeOut = setTimeout(() => nextSlide(slides, isCycle), duration)
      } else {
        if (slides[frameId + 1]) {
          frameId += 1;
          timeOut = setTimeout(() => nextSlide(slides, isCycle), duration);
        } else {
          frameId = 0;
          nextAnimation()
        };
      }
    };

    const nextAnimation = () => {
      if (idx === undefined) {
        idx = 0;
      } else if (animations[idx + 1]) {
        idx += 1;
      } else {
        clearTimeout(timeOut);
        return;
      };
      animation = animations[idx];
      const slides = animation.slides;
      const isCycle = animation.isCycle;
      nextSlide(slides, isCycle)
    };

    nextAnimation()

  };

  const chooseSlide = (animation) => {
    clearTimeout(timeOut);
    drawFrame(animation[0])
  };

  drawFrame(jump.slides[0]);


  animateButton.onclick = () => {

    //frameId = 0; animate(jumpAndFire);
    frameId = 0; animate(jump, jumpAndFire);
  };

  stopButton.onclick = () => {
    clearTimeout(timeOut);
    frameId = 0;
  }

</script>


<style>
  .container {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
  }

  .control {
    position: fixed;
    top: 0;
    left: 0;
    height: 50px;
  }

  .control>button {
    height: 100%;
  }

  .test {
    width: 160px;
    height: 145px;
    background-image: url(./sprite-sheets/enemy/dragon.png);
    background-position: 0px 0px;
    background-repeat: no-repeat;
  }
</style>